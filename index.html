<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>LIPNÍK ŽIJE!</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        margin: 0;
        height: 100vh;
        background-color: #111;
        color: white;
    }
    #calendar {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background-color: #222;
    }
    #posters {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #000;
        position: relative;
    }
    .event {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #444;
    }
    .event-date {
        font-weight: bold;
        color: #ffcc00;
    }
    .event-title {
        font-size: 18px;
        margin: 5px 0;
    }
    .event-description {
        font-size: 14px;
        color: #ccc;
    }
    #posterImage {
        max-width: 90%;
        max-height: 90%;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(255,255,255,0.3);
        opacity: 1;
        transition: opacity 1s ease-in-out;
        position: absolute;
    }
    .fade-out {
        opacity: 0;
    }
</style>
</head>
<body>

<div id="calendar">
    <h2>Kalendář akcí</h2>
    <div id="events">Načítám události...</div>
</div>

<div id="posters">
    <img id="posterImage" src="" alt="Plakát">
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2ppsqGwnoqU4XvAxp-SYbQtzzoLxFcaKT5X8iojVLPDvyHGpOVYQDztvFaRdOm-9SzDoFZ9PNoKKZ/gviz/tq?tqx=out:json";

let posters = [];
let currentPoster = 0;

function fetchEvents() {
    fetch(sheetURL)
        .then(res => res.text())
        .then(data => {
            const json = JSON.parse(data.substr(47).slice(0, -2));
            const rows = json.table.rows;
            let html = "";
            posters = [];

            rows.forEach(row => {
                let date = row.c[0] ? row.c[0].f : "";
                let title = row.c[1] ? row.c[1].v : "";
                let description = row.c[2] ? row.c[2].v : "";
                let posterURL = row.c[3] ? row.c[3].v : "";

                html += `
                    <div class="event">
                        <div class="event-date">${date}</div>
                        <div class="event-title">${title}</div>
                        <div class="event-description">${description}</div>
                    </div>
                `;

                if (posterURL) posters.push(posterURL);
            });

            document.getElementById("events").innerHTML = html || "Žádné akce";
            if (posters.length > 0) {
                currentPoster = 0;
                document.getElementById("posterImage").src = posters[0];
            }
        })
        .catch(err => {
            document.getElementById("events").innerHTML = "Chyba při načítání dat";
            console.error(err);
        });
}

function rotatePosters() {
    if (posters.length > 0) {
        const img = document.getElementById("posterImage");
        img.classList.add("fade-out");
        setTimeout(() => {
            currentPoster = (currentPoster + 1) % posters.length;
            img.src = posters[currentPoster];
            img.classList.remove("fade-out");
        }, 1000); // čas fade-out odpovídá CSS transition
    }
}

fetchEvents();
setInterval(rotatePosters, 5000);     // rotace plakátů
setInterval(fetchEvents, 600000);     // obnovení dat každých 10 minut
</script>

</body>
</html>
