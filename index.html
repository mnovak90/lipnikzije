<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>LIPNÍK ŽIJE! – Kalendář akcí</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        margin: 0;
        height: 100vh;
        background: #f5f5f5;
    }
    #calendar {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: white;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }
    #calendar h2 {
        text-align: center;
    }
    .event {
        border-bottom: 1px solid #ddd;
        padding: 10px 0;
    }
    .event strong {
        color: #333;
    }
    #poster {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        background: black;
    }
    #poster img {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        position: absolute;
    }
    #poster img.active {
        opacity: 1;
    }
</style>
</head>
<body>
    <div id="calendar">
        <h2>Kalendář akcí</h2>
        <div id="events">Načítám události...</div>
    </div>
    <div id="poster"></div>

<!-- PapaParse knihovna pro korektní načtení CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2ppsqGwnoqU4XvAxp-SYbQtzzoLxFcaKT5X8iojVLPDvyHGpOVYQDztvFaRdOm-9SzDoFZ9PNoKKZ/pub?output=csv";
let posters = [];
let currentPosterIndex = 0;

async function fetchCSV() {
    document.getElementById("events").innerHTML = "Načítám události...";
    try {
        const res = await fetch(CSV_URL);
        const csvData = await res.text();

        const parsed = Papa.parse(csvData, { header: true, skipEmptyLines: true });
        const data = parsed.data;

        let eventsHTML = "";
        posters = [];

        data.forEach(row => {
            let date = row["date"] || row["Datum"] || "";
            let name = row["name"] || row["Název"] || "";
            let description = row["description"] || row["Popis"] || "";
            let imageUrl = row["image"] || row["Obrázek"] || "";

            eventsHTML += `<div class="event"><strong>${date} – ${name}</strong><br>${description}</div>`;

            if (imageUrl) {
                posters.push(imageUrl);
            }
        });

        document.getElementById("events").innerHTML = eventsHTML || "Žádné nadcházející akce";
        renderPosters();
    } catch (error) {
        document.getElementById("events").innerHTML = "Chyba při načítání dat.";
        console.error(error);
    }
}

function renderPosters() {
    const posterDiv = document.getElementById("poster");
    posterDiv.innerHTML = "";

    posters.forEach((url, index) => {
        let img = document.createElement("img");
        img.src = url;
        if (index === 0) img.classList.add("active");
        posterDiv.appendChild(img);
    });

    currentPosterIndex = 0;
}

function rotatePosters() {
    if (posters.length <= 1) return;
    const images = document.querySelectorAll("#poster img");
    images[currentPosterIndex].classList.remove("active");
    currentPosterIndex = (currentPosterIndex + 1) % posters.length;
    images[currentPosterIndex].classList.add("active");
}

// Načíst poprvé
fetchCSV();

// Rotace plakátů každých 5 sekund
setInterval(rotatePosters, 5000);

// Automatické obnovení dat každých 10 minut
setInterval(fetchCSV, 10 * 60 * 1000);
</script>
</body>
</html>
